<!DOCTYPE html>
<html>
  <!-- 1、引入 CDN 包 -->
<head>
  <meta charset="utf-8">
  <title>PayerMax Dropin - Google Pay</title>
  <script src="https://cdn.payermax.com/dropin/js/pmdropin.min.js"></script>
</head>

<body>
  <div style="margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; max-width: 500px;">
    <h3 style="text-align: center;">配置参数</h3>
    <div style="margin-bottom: 15px;">
      <label for="clientKeyInput" style="display: block; margin-bottom: 5px;">Client Key:</label>
      <input type="text" id="clientKeyInput" value="67eff2f3b29a4ecf9576321185dbf658" 
             style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
    </div>
    <div style="margin-bottom: 15px;">
      <label for="sessionKeyInput" style="display: block; margin-bottom: 5px;">Session Key:</label>
      <input type="text" id="sessionKeyInput" value="d761598bb8e049f4b0ba9e124395d53a" 
             style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
    </div>
    <div style="margin-bottom: 15px;">
      <label for="environmentInput" style="display: block; margin-bottom: 5px;">Environment:</label>
      <select id="environmentInput" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        <option value="true" selected>Sandbox (测试环境)</option>
        <option value="false">Production (生产环境)</option>
      </select>
    </div>
    <div style="text-align: center;">
      <button id="initButton" style="padding: 10px 20px; background-color: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
        初始化组件
      </button>
    </div>
  </div>
  <!-- 2、页面嵌入一个iframes -->
  <div class="frame-googlepay" style="margin: 20px auto; width: 240px; height: 40px;">
    <!-- Google Pay button will be added here -->
  </div>

  <div style="text-align: center;">
    <div id="tokenDisplay" style="margin: 20px auto; padding: 15px; max-width: 600px; background-color: #f5f5f5; border-radius: 5px; word-break: break-all; display: none;">
      <strong>Payment Token:</strong>
      <div id="tokenValue" style="margin-top: 10px; font-family: monospace; color: #333;"></div>
    </div>
  </div>
  <!-- 3、初始化 PayerMax Frames -->
  <script type="text/javascript">
    var googlePay = null;

    // 初始化组件函数
    function initGooglePay() {
      var clientKey = document.getElementById('clientKeyInput').value;
      var sessionKey = document.getElementById('sessionKeyInput').value;
      var environment = document.getElementById('environmentInput').value;
      var isSandbox = environment === 'true';

      // 如果已经存在组件，先卸载
      if (googlePay) {
        googlePay.unmount();
      }

      // 初始化 Google Pay 组件
      googlePay = PMdropin.create('googlepay', {
        clientKey: clientKey,
        sessionKey: sessionKey,
        sandbox: isSandbox,
        payButtonConfig: {   
          buttonRadius: "12",
          buttonColor: "white",
          buttonType: "order",
          buttonLocale: "en",
          width: "240px",
          height: "40px"
        }
      });

      // 按钮挂载
      googlePay.mount('.frame-googlepay');

	  <!-- 4、监听 -->
      // Google Pay 事件监听
      googlePay.on('ready', () => {
        console.log('组件初始化完成');
        alert('组件初始化成功！环境: ' + (isSandbox ? '测试环境' : '生产环境'));
      });

      googlePay.on('load', (res = {}) => {
        const { code, msg } = res || {};
        if (code === "SUCCESS") {
          console.log('[merchant][load]success:', res);
        } else {
          console.log('[merchant][load]fail:', res);
        }
      });

    <!-- 5、用户点击发起支付，检查是否可支付，并获取paymentToken -->
      googlePay.on('payButtonClick', (res) => {
        googlePay.emit('setDisabled', true);
        googlePay.emit('canMakePayment')
          .then(paymentRes => {
            if (paymentRes.code === 'APPLY_SUCCESS') {
              const paymentToken = paymentRes?.data?.paymentToken;
              console.log('paymentToken:', paymentToken);
              
              // 显示 token
              document.getElementById('tokenValue').textContent = paymentToken;
              document.getElementById('tokenDisplay').style.display = 'block';
              
              // 这里需要自行请求服务端，实现服务端下单的操作
              // 下单成功后，调用 googlePay.emit('paySuccess') 或 googlePay.emit('payFail')
              
              googlePay.emit('setDisabled', false);
            } else {
              console.log('error: ' + paymentRes.msg);
              console.log('code:' + paymentRes.code);
              googlePay.emit('setDisabled', false);
            }
          })
          .catch(err => {
            console.error('支付能力检测失败:', err);
            googlePay.emit('setDisabled', false);
          });
      });
    }

    // 初始化按钮点击事件
    document.getElementById('initButton').addEventListener('click', initGooglePay, false);
  </script>
</body>
</html>
